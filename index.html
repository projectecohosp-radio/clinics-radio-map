<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Geospatial Health Broadcast</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
  html,body,#map { height:100%; margin:0; padding:0; }
  body { font-family: system-ui, Arial, sans-serif; }
  .top-bar { padding:10px 14px; background:#fff; border-bottom:1px solid #eee; }
  .top-bar h1 { margin:0; font-size:18px; color:#16325c; }
  .top-bar p { margin:4px 0 0; color:#555; font-size:13px; }
  .pulse-green { width:18px;height:18px;background:rgba(0,180,0,1);border-radius:50%;border:2px solid white;position:relative; }
  .pulse-red { width:18px;height:18px;background:rgba(220,30,30,1);border-radius:50%;border:2px solid white;position:relative; }
  .pulse-green::after, .pulse-red::after {
    content:'';
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:100%;
    height:100%;
    border-radius:50%;
    animation:pulse 1.6s infinite;
  }
  .pulse-green::after { background: rgba(0,180,0,0.45); }
  .pulse-red::after { background: rgba(220,30,30,0.45); }

  @keyframes pulse {
    0% { transform:translate(-50%,-50%) scale(0.7); opacity:0.9; }
    70% { transform:translate(-50%,-50%) scale(2.3); opacity:0; }
    100% { opacity:0; }
  }

  .legend {
    background: rgba(255,255,255,0.95);
    padding:8px 10px;
    border-radius:6px;
    box-shadow:0 1px 4px rgba(0,0,0,0.15);
    font-size:13px;
  }
  .legend .dot {
    display:inline-block;
    width:12px;
    height:12px;
    border-radius:50%;
    margin-right:8px;
    vertical-align:middle;
  }
  .legend .green { background:#00b400; }
  .legend .red { background:#d31e1e; }

  .info-note {
    position:absolute;
    left:14px;
    bottom:14px;
    background: rgba(255,255,255,0.95);
    padding:8px 12px;
    border-radius:6px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.12);
    font-size:13px;
  }
</style>
</head>

<body>

<div class="top-bar">
  <h1>Geospatial Health Broadcast</h1>
  <p>Patient Education & Public Health Awareness — Geo-mapped Clinic Broadcasts</p>
</div>

<div id="map"></div>

<div class="info-note">
  Share per-doctor link: <code>?id=CR001</code>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ---------------- INDIA MAP LOCK ----------------
const indiaBounds = L.latLngBounds(
  [6.5, 68.0],    // South-West
  [37.5, 97.5]    // North-East
);

// ---------------- MAP INIT ----------------
const map = L.map('map', {
  maxBounds: indiaBounds,
  maxBoundsViscosity: 1.0,
  minZoom: 4,
  maxZoom: 18
}).setView([22.0, 80.0], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

map.fitBounds(indiaBounds);

// ---------------- DATA ----------------
const clinics = [
  /* YOUR CLINIC DATA — UNCHANGED */
];

// ---------------- HELPERS ----------------
function getParam(name) {
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}

function greenIcon() {
  return L.divIcon({
    className:'',
    html:'<div class="pulse-green"></div>',
    iconSize:[18,18],
    iconAnchor:[9,9]
  });
}

function redIcon() {
  return L.divIcon({
    className:'',
    html:'<div class="pulse-red"></div>',
    iconSize:[18,18],
    iconAnchor:[9,9]
  });
}

// ---------------- MARKERS ----------------
const singleId = getParam('id');
const markers = [];

clinics.forEach(cl => {
  if (singleId && singleId !== cl.id) return;

  const icon = cl.status === 'Active' ? greenIcon() : redIcon();
  const marker = L.marker([cl.lat, cl.lon], { icon }).addTo(map);

  marker.bindPopup(
    `<div style="font-size:14px;line-height:1.3;">
      <strong>ID:</strong> ${cl.id}<br>
      <strong>Clinic:</strong> ${cl.clinic}<br>
      <strong>Doctor:</strong> —<br>
      <strong>City:</strong> ${cl.city}, ${cl.state}<br>
      <strong>Status:</strong> ${cl.status}
    </div>`
  );

  markers.push(marker);

  if (singleId && singleId === cl.id) {
    marker.openPopup();
    map.setView([cl.lat, cl.lon], 13);
  }
});

if (!singleId && markers.length > 0) {
  L.featureGroup(markers).addTo(map);
}

// ---------------- LEGEND ----------------
const legend = L.control({ position: 'topright' });
legend.onAdd = function () {
  const div = L.DomUtil.create('div', 'legend');
  div.innerHTML = `
    <div><span class="dot green"></span> Active</div>
    <div style="margin-top:6px;"><span class="dot red"></span> Non-Active</div>
  `;
  return div;
};
legend.addTo(map);

</script>
</body>
</html>

